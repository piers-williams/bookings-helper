# Product Backlog — 2026-02-28

## Context

Phase 1 MVP is complete: OSM sync, email capture via Chrome extension, auto-linking, privacy hashing, and a React dashboard. Two open issues exist (#8 Remove office code, #9 Quality principles). The system works end-to-end for the core flow (view email in OWA → extension captures → backend links to booking → side panel shows match), but several endpoints still return mock data and key Phase 2 features are missing.

## Key Observations

1. **Mock data still served** — `GET /api/emails`, `GET /api/bookings/{id}` detail, and `GET /api/comments` all return hardcoded mock data instead of reading from the database
2. **Office 365 code is dead weight** — Extension now handles email capture; Office365Service and related code should be removed (Issue #8)
3. **Comments not synced to DB** — OsmService can fetch comments but they're not persisted during sync
4. **Limited test coverage** — Only 3 integration test classes; no tests for linking service logic, booking detail, or comments
5. **User context hardcoded** — userId=1 throughout; no auth flow for the web app itself
6. **Extension sidebar manual link** — UI exists but isn't wired to the backend POST endpoint

---

## Prioritised Backlog

### 1. Remove Office 365 code — [Issue #8](https://github.com/piers-williams/bookings-helper/issues/8)
**User story:** As a developer, I want dead code removed, so that the codebase is simpler and easier to maintain.
**Impact:** Low | **Effort:** Low
**Description:** Delete Office365Service, related DTOs, and any OAuth infrastructure for Microsoft Graph. The Chrome extension now handles all email ingestion. This is pure cleanup with no user-facing change but reduces confusion.

### 2. Replace mock email list with DB reads — [Issue #10](https://github.com/piers-williams/bookings-helper/issues/10)
**User story:** As a booking manager, I want to see real captured emails on the dashboard, so that I can review and manage them.
**Impact:** High | **Effort:** Low
**Description:** `GET /api/emails` currently returns hardcoded mock data. Replace with a query against the EmailMessages table. Include pagination. This makes the dashboard functional with real data.

### 3. Replace mock booking detail with DB reads — [Issue #11](https://github.com/piers-williams/bookings-helper/issues/11)
**User story:** As a booking manager, I want to see real booking details (with linked emails and comments), so that I have full context when managing a booking.
**Impact:** High | **Effort:** Low
**Description:** `GET /api/bookings/{id}` returns mock detail data. Replace with a DB query joining OsmBooking → ApplicationLinks → EmailMessages. Return real linked emails and comments.

### 4. Sync and persist OSM comments — [Issue #12](https://github.com/piers-williams/bookings-helper/issues/12)
**User story:** As a booking manager, I want to see OSM comments on each booking, so that I can track the conversation history without switching to OSM.
**Impact:** High | **Effort:** Medium
**Description:** During booking sync (or on booking detail fetch), call the OSM comments endpoint and persist results to the OsmComments table. Add a migration if needed. Wire comments into the booking detail response.

### 5. Replace mock comments list with DB reads — [Issue #13](https://github.com/piers-williams/bookings-helper/issues/13)
**User story:** As a booking manager, I want the "new comments" section on the dashboard to show real data, so that I can spot activity quickly.
**Impact:** High | **Effort:** Low
**Description:** `GET /api/comments` returns mock data. Once comments are synced (#4), replace with a DB query. Filter by date or "new since last viewed" flag.

### 6. Wire extension manual link to backend — [Issue #14](https://github.com/piers-williams/bookings-helper/issues/14)
**User story:** As a booking manager, I want to manually link an email to a booking from the Chrome side panel when auto-matching fails, so that I can associate them without opening the dashboard.
**Impact:** Medium | **Effort:** Low
**Description:** The side panel has a "suggested bookings" section but clicking to link doesn't call the backend. Wire the click handler to `POST /api/links` and refresh the panel on success.

### 7. Add integration tests for linking service — [Issue #15](https://github.com/piers-williams/bookings-helper/issues/15)
**User story:** As a developer, I want comprehensive tests for the linking logic, so that changes don't break email-to-booking matching.
**Impact:** Medium | **Effort:** Medium
**Description:** Test regex extraction with various booking ref formats. Test hash-based fallback matching. Test edge cases (no match, multiple matches, duplicate emails). Currently LinkingService is only tested indirectly through EmailCaptureTests.

### 8. Add comment posting to OSM from dashboard — [Issue #16](https://github.com/piers-williams/bookings-helper/issues/16)
**User story:** As a booking manager, I want to post a comment to a booking from the dashboard, so that I can respond without switching to OSM.
**Impact:** High | **Effort:** Medium
**Description:** Add a POST endpoint that writes a comment to OSM via their API. Add a form component on the booking detail page. This is the first "write-back" feature — a Phase 2 milestone.

---

## Recommended Execution Order

1. **#1 Remove Office 365 code** — Quick cleanup, reduces noise for all subsequent work
2. **#2 Replace mock email list** — Highest visibility improvement, makes dashboard real
3. **#3 Replace mock booking detail** — Completes the "real data" story for the main views
4. **#4 Sync and persist comments** — Prerequisite for #5 and #8
5. **#5 Replace mock comments list** — Completes the dashboard with real data
6. **#6 Wire extension manual link** — Quick extension improvement
7. **#7 Add linking tests** — Strengthen test coverage before Phase 2 actions
8. **#8 Add comment posting** — First write-back feature, opens the door to Phase 2

Items 1-3 can be done rapidly (1 session each). Item 4 is the lynchpin for comments-related work. Items 6-7 are independent and can be parallelised.
